# Generated by GitHub Copilot on 2026-01-01

from django.db import migrations


def seed_default_groupchats(apps, schema_editor):
    ChatGroup = apps.get_model('a_rtchat', 'ChatGroup')

    # base_name is used for loose matching so existing emoji variants don't get duplicated.
    defaults = [
        # ğŸš€ Tech & Coding
        ('Code & Coffee', 'Code & Coffee â˜•'),
        ('The Syntax Squad', 'The Syntax Squad'),
        ('Bug Hunters', 'Bug Hunters ğŸ'),
        ('FullStack Circle', 'FullStack Circle'),

        # ğŸ¤ Professional & Indian Vibes
        ('Indian-Boys', 'Indian-Boys ğŸ”ªğŸ‘»'),
        ('The Nexus', 'The Nexus'),
        ('Growth Mindset', 'Growth Mindset'),

        # âœ¨ Social & Fun
        ('Backbenchers', 'Backbenchers ğŸ˜'),
        ('Vibe Check', 'Vibe Check âš¡'),
        ('Nalayak Gang', 'Nalayak Gang ğŸ¤¡'),
        ('Girls Group', 'Girls Group ğŸ’…âœ¨'),
        ('Late Night Owls', 'Late Night Owls ğŸ¦‰'),

        # ğŸ“¢ Promotion (no uploads, but links allowed)
        ('Free Promotion', 'Free Promotion ğŸ“¢'),
    ]

    for base, display in defaults:
        base_l = base.lower()
        # If a room already exists with either group_name or groupchat_name containing the base,
        # don't create another one.
        exists = (
            ChatGroup.objects.filter(group_name__icontains=base_l).exists()
            or ChatGroup.objects.filter(groupchat_name__icontains=base_l).exists()
        )
        if exists:
            continue

        ChatGroup.objects.create(
            group_name=display,
            groupchat_name=display,
            is_private=False,
            is_code_room=False,
        )


def unseed_default_groupchats(apps, schema_editor):
    """Best-effort reverse: remove only the rooms we created by exact group_name match."""
    ChatGroup = apps.get_model('a_rtchat', 'ChatGroup')
    names = [
        'Code & Coffee â˜•',
        'The Syntax Squad',
        'Bug Hunters ğŸ',
        'FullStack Circle',
        'Indian-Boys ğŸ”ªğŸ‘»',
        'The Nexus',
        'Growth Mindset',
        'Backbenchers ğŸ˜',
        'Vibe Check âš¡',
        'Nalayak Gang ğŸ¤¡',
        'Girls Group ğŸ’…âœ¨',
        'Late Night Owls ğŸ¦‰',
        'Free Promotion ğŸ“¢',
    ]
    ChatGroup.objects.filter(group_name__in=names).delete()


class Migration(migrations.Migration):

    dependencies = [
        ('a_rtchat', '0012_messagereaction_readd'),
    ]

    operations = [
        migrations.RunPython(seed_default_groupchats, reverse_code=unseed_default_groupchats),
    ]
