{% extends 'base.html' %}

{% block content %}
<div class="w-full max-w-2xl mx-auto">
    <div class="rounded-2xl border border-gray-800 bg-gray-900/50 backdrop-blur p-5 sm:p-6">
        <div class="flex items-start justify-between gap-4">
            <div>
                <h1 class="text-xl sm:text-2xl font-bold text-white">Invite your friends</h1>
                <p class="mt-1 text-sm text-gray-400">Share this link â€” your friends can join Vixogram in one tap.</p>
            </div>
            <a href="{% url 'home' %}" class="text-sm text-gray-300 hover:text-white px-3 py-2 rounded-lg hover:bg-gray-800 transition-colors">Back</a>
        </div>

        <div class="mt-5 grid grid-cols-1 sm:grid-cols-2 gap-3">
            <div class="rounded-2xl border border-gray-800 bg-gray-950/40 p-4">
                <div class="text-xs uppercase tracking-wider text-gray-400">Your points</div>
                <div class="mt-1 text-2xl font-extrabold text-emerald-300">{{ points|default:0 }}</div>
                <div class="mt-1 text-xs text-gray-500">Points count only after your friend verifies email.</div>
            </div>
            <div class="rounded-2xl border border-gray-800 bg-gray-950/40 p-4">
                <div class="text-xs uppercase tracking-wider text-gray-400">Rewards</div>
                <div class="mt-1 text-sm font-semibold text-white">Founder Club</div>
                <div class="mt-2 text-xs text-gray-400">
                    ðŸ‘‘ {{ required_points }} Points ({{ required_invites }} Invites)
                </div>
                <div class="mt-2 text-xs text-gray-500 space-y-1">
                    <div>âœ… Founder Club</div>
                    <div>No ads (future)</div>
                    <div>Special role</div>
                    <div>Name glow / crown icon</div>
                    <div>Access to beta features</div>
                </div>
                <div class="mt-3 text-[11px] text-gray-500">
                    Account must be at least {{ min_account_age_days }} days old.
                    After Founder Club is active, your account must stay active minimum 1 hour every day,
                    otherwise the role will be removed.
                    To reactivate, reapply will be available after 20 days.
                </div>
            </div>
        </div>

        {% if points|default:0 >= required_points %}
            <div class="mt-5 rounded-2xl border border-gray-800 bg-gray-950/40 p-4">
                <div class="text-sm font-semibold text-gray-200">Available redemption reward</div>
                <div class="mt-2 text-sm font-semibold text-white">Founder Club</div>
                <div class="mt-3 rounded-xl border border-gray-800 bg-gray-900/50 p-3">
                    {% if is_founder_club %}
                        <div class="text-sm text-emerald-300 font-semibold">Already active on your account âœ…</div>
                    {% elif founder_can_apply %}
                        <a href="{% url 'founder-club-apply' %}" class="inline-flex items-center justify-center w-full bg-emerald-500 hover:bg-emerald-600 text-white font-semibold rounded-xl px-5 py-2.5 transition-colors">
                            Fill up form â€¢ Avail this role
                        </a>
                    {% else %}
                        <div class="text-xs text-gray-400">
                            Not ready yet.
                            {% if not founder_meets_invites %}Need {{ required_invites }} verified invites.{% endif %}
                            {% if not founder_meets_age %} Account must be {{ min_account_age_days }} days old.{% endif %}
                            {% if founder_reapply_at %} Reapply available after {{ founder_reapply_at|date:"M d, Y" }}.{% endif %}
                        </div>
                    {% endif %}
                </div>
            </div>
        {% endif %}

        <div class="mt-5 rounded-2xl border border-gray-800 bg-gray-950/40 p-4">
            <div class="text-sm font-semibold text-gray-200">Your invite link</div>
            <div class="mt-2 flex flex-col sm:flex-row gap-2">
                <input
                    id="invite_link"
                    type="text"
                    readonly
                    value="{{ invite_url }}"
                    class="w-full flex-1 bg-gray-900/60 border border-gray-800 rounded-xl px-3 py-2.5 text-sm text-gray-200 focus:outline-none focus:ring-2 focus:ring-emerald-500/40"
                    aria-label="Invite link"
                />
                <button
                    type="button"
                    id="copy_invite"
                    class="bg-emerald-500 hover:bg-emerald-600 text-white rounded-xl px-5 py-2.5 transition-colors"
                >
                    Copy
                </button>
            </div>

            <div class="mt-3 flex flex-wrap items-center gap-2">
                <a
                    id="wa_share"
                    href="#"
                    target="_blank"
                    rel="noopener noreferrer"
                    class="px-4 py-2 rounded-xl border border-gray-800 bg-gray-900/60 hover:bg-gray-800/60 text-sm text-gray-200 transition"
                >
                    WhatsApp
                </a>
                <a
                    id="tg_share"
                    href="#"
                    target="_blank"
                    rel="noopener noreferrer"
                    class="px-4 py-2 rounded-xl border border-gray-800 bg-gray-900/60 hover:bg-gray-800/60 text-sm text-gray-200 transition"
                >
                    Telegram
                </a>
                <button
                    type="button"
                    id="native_share"
                    class="px-4 py-2 rounded-xl border border-gray-800 bg-gray-900/60 hover:bg-gray-800/60 text-sm text-gray-200 transition"
                >
                    Share
                </button>
            </div>

            <p class="mt-3 text-xs text-gray-500">Tip: If Share doesnâ€™t work on desktop, use Copy.</p>
        </div>

        <div id="invite_toast" class="hidden mt-4 rounded-xl border border-emerald-600/30 bg-emerald-500/10 px-4 py-3 text-sm text-emerald-200">
            Copied!
        </div>
    </div>
</div>

<script>
(function () {
    const linkInput = document.getElementById('invite_link');
    const copyBtn = document.getElementById('copy_invite');
    const toast = document.getElementById('invite_toast');
    const inviteUrl = linkInput ? linkInput.value : '';

    function showToast() {
        if (!toast) return;
        toast.classList.remove('hidden');
        window.clearTimeout(showToast._t);
        showToast._t = window.setTimeout(() => toast.classList.add('hidden'), 1800);
    }

    async function copyText(text) {
        try {
            if (navigator.clipboard && window.isSecureContext) {
                await navigator.clipboard.writeText(text);
                return true;
            }
        } catch (e) {}
        try {
            const tmp = document.createElement('textarea');
            tmp.value = text;
            tmp.setAttribute('readonly', '');
            tmp.style.position = 'fixed';
            tmp.style.left = '-9999px';
            document.body.appendChild(tmp);
            tmp.select();
            const ok = document.execCommand('copy');
            document.body.removeChild(tmp);
            return ok;
        } catch (e) {
            return false;
        }
    }

    if (copyBtn) {
        copyBtn.addEventListener('click', async () => {
            const ok = await copyText(inviteUrl);
            if (ok) showToast();
            if (linkInput) linkInput.focus();
        });
    }

    const wa = document.getElementById('wa_share');
    if (wa) {
        const msg = encodeURIComponent('Join me on Vixogram: ' + inviteUrl);
        wa.href = 'https://wa.me/?text=' + msg;
    }

    const tg = document.getElementById('tg_share');
    if (tg) {
        const msg = encodeURIComponent('Join me on Vixogram!');
        tg.href = 'https://t.me/share/url?url=' + encodeURIComponent(inviteUrl) + '&text=' + msg;
    }

    const nativeBtn = document.getElementById('native_share');
    if (nativeBtn) {
        nativeBtn.addEventListener('click', async () => {
            if (!navigator.share) {
                const ok = await copyText(inviteUrl);
                if (ok) showToast();
                return;
            }
            try {
                await navigator.share({
                    title: 'Vixogram',
                    text: 'Join me on Vixogram',
                    url: inviteUrl,
                });
            } catch (e) {}
        });
    }
})();
</script>
{% endblock %}
